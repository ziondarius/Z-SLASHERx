# Update v3.0: Polish & Core Experience

**Status:** Done
**Date:** 2025-12-09
**Focus:** Stabilize the single-player experience, fix "game feel" bugs, and improve codebase extensibility.

MANDATORY: For every issue and iteration the following are required before merge: (1) A written Definition of Done (DoD) satisfied, (2) Automated tests covering success + at least one edge case, (3) Manual smoke test (launch, menu navigation, start game, pause) recorded in PR notes. No merge without green tests and DoD checklist fully checked.

---

## Guiding Principles
- Single event loop & explicit game states (Menu, Game, Pause, Store, etc.)
- Separation of concerns: domain (gameplay) vs presentation (render/UI) vs infrastructure (assets, persistence, input)
- No magic numbers â†’ central constants
- Data orientation: prefer small, pure functions
- Minimize IO (asset, text & level list caching)
- Deterministic & testable logic (headless where possible)
- Incremental migration (backward compatible for existing save data)

---

## 1. Strategic Focus

**Strategy:** "Polish & Core Experience"

Given the recent successful refactoring (v2.0) and the robust but complex state of the networking/multiplayer foundation, the most strategic move is **not** to jump straight into Multiplayer. Instead, we focus on stabilizing the single-player experience, fixing "game feel" bugs, and paying off remaining technical debt.
This roadmap structures concrete iterations with explicit issues & acceptance criteria. All code and documentation now in English only.
This aligns with the goal of a quality codebase (KISS) and prepares the ground for future Multiplayer implementation (e.g., rock-solid Input/Settings/AI).

---

## 2. Feature Roadmap

### A. High Priority: Critical Bugs & Game Feel
These issues directly degrade the player experience and are the first targets.

- [x] **Fix Pause State**
    - **Issue:** Camera continues to scroll/update even when paused; game logic persists in background.
    - **Solution:** Move camera scroll logic from `Renderer.render` to `GameState.update`. Ensure pause completely halts updates.
- [x] **Fix Respawn Determinism ("Sky Fall Bug")**
    - **Issue:** Player respawn coordinates vary, breaking replay reliability.
    - **Solution:** Enforce strict coordinate resets in `Player.respawn`. Reset/Rollback RNGService correctly.
- [x] **Smoother Level Transitions**
    - **Goal:** Replace abrupt level switch with a "Level Complete" flow.
    - **Plan:** Finish Screen -> Confirmation -> Next Level Spawn.
- [x] **Fix Performance HUD**
    - **Issue:** Parameters (e.g., cache) display incorrectly; dual control conflict (Renderer vs GameState).
    - **Plan:**
        - Centralize "Show HUD" source of truth.
        - **Change:** Remove Menu option; enable ONLY via `F1` key.
- [x] **Ghost Polish**
    - **Issue:** Ghost disappears immediately upon finishing.
    - **Plan:** Ghost should remain idle at the finish flag.

### B. Medium Priority: Content & Extensibility
Prove that the v2.0 architecture allows for easy content addition.

- [x] **New AI Behaviors**
    - **Goal:** Validate `PolicyService` extensibility.
    - **Chaser:** Enemy actively chases player within a territory.
    - **Jumper:** Defends vertically and horizontally; harder to overcome.
- [x] **Upgrade Audio Experience**
    - **Goal:** distinct auditory identity per level.
    - **Plan:** Assign unique soundtracks to each level. Standardize entity SFX across levels.
- [x] **Audio Ducking**
    - **Goal:** Dynamic mixing based on game events.
- [x] **Configurable Key Bindings (Backend Only)**
    - **Goal:** Support custom controls without building the UI yet.
    - **Plan:** Refactor `InputRouter` to load keys from `settings.json`. Skip UI implementation for now.

### C. Infrastructure (Technical Debt)
- [x] **Localization Foundation (i18n)**
    - **Goal:** Move hardcoded strings from `scripts/ui.py` to a dictionary/JSON file.
    - **Why:** Prepares for future translation support.

---

## 3. Backlog (Postponed)
- **Multiplayer:** Postponed. Requires significant transport layer work (UDP/Sockets).
- **Map Hot Reload:** Low priority.
